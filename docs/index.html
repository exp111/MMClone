<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="index.css">
    </style>
    <script src="dependencies/leaflet/leaflet.js"></script>
    <link rel="stylesheet" href="dependencies/leaflet/leaflet.css" />
    <script src="dependencies/idb/umd.js"></script>
    <script src="dependencies/leaflet.offline/bundle.js"></script>
    <script src="dependencies/jszip/jszip.min.js"></script>
    <script src="dependencies/leaflet.contextmenu/leaflet.contextmenu.min.js"></script>
    <link rel="stylesheet" href="dependencies/leaflet.contextmenu/leaflet.contextmenu.min.css" />
</head>

<body>
    <div id="map"></div>
    <button id="menu-button" class="overlay-button" onclick="setMenuVisible('menu', true)">
        <div style="border-style: solid">
            <h1>MENU</h1>
        </div>
    </button>
    <div id="menu" class="overlay" style="bottom: 100%">
        <button class="close-button" onclick="setMenuVisible('menu', false)">×</button>
        <div class="overlay-content">
            <button onclick="askForFile(handleZipFile)">Upload Zip</button>
            <button onclick="askForFile(handleCaseFile)">Upload Case File</button>
            <button onclick="loadTestMap()">Load Test Map</button>
        </div>
    </div>
    <button id="debug-menu-button" class="overlay-button" onclick="setMenuVisible('debug-menu', true)">
        <div style="border-style: solid">
            <h1>DEBUG</h1>
        </div>
    </button>
    <div id="debug-menu" class="overlay" style="bottom: 100%">
        <button class="close-button" onclick="setMenuVisible('debug-menu', false)">×</button>
        <div class="overlay-content">
            <div class="overlay-input">
                <input type="checkbox" id="debug_toggle" onchange="Global.DEBUG = !Global.DEBUG" />
                <label for="debug_toggle">DEBUG</label>
            </div>
            <button onclick="clearMapDB()">Clear Map DB</button>
            <button onclick="clearCaseDB()">Clear Case DB</button>
            <button onclick="clearCaseImgDB()">Clear Case Img DB</button>
            <button onclick="solveStep()">Solve</button>
            <button onclick="progressCase()">Force Next</button>
        </div>
    </div>
    <label for="select_case">Choose Case:</label>
    <select id="select_case" onchange="handleCaseChange(this)">
        <option value="Placeholder">
    </select>
    <p id="case_objective"></p>
    <div>
        <h1 id="case_solution_title"></h1>
        <p id="case_solution_text"></p>
    </div>
    <button id="button_next" onclick="progressCase()">Next</button>
    <div>
        <img id="case_img_front" />
        <img id="case_img_back" />
    </div>
    <script>
        var Global = {
            DEBUG: window.location.protocol == "file:" || window.location.hostname == "localhost",
            map: null,
            baseLayer: null,
            cases: {},
            currentCase: null,
            caseProgress: 0, //TODO: read from/save to idb,
            caseMarkers: [],
            markers: [],
            mapMetadata: {
                name: "Placeholder",
                minZoom: 2,
                maxZoom: 6,
                width: 300,
                height: 300
            }
        }
    </script>
    <script src="ui.js"></script>
    <script src="upload.js"></script>
    <script src="contextmenu.js"></script>
    <script src="map.js"></script>
    <script src="case.js"></script>
    <script>
        document.getElementById("debug-menu-button").hidden = !Global.DEBUG; // hide if not debug
        document.getElementById("debug_toggle").checked = Global.DEBUG;

        initMap();
        refreshCases();
    </script>

</body>

</html>