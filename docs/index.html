<!DOCTYPE html>
<html>

<head>
    <title>MM Clone</title>
    <script src="dependencies/leaflet/leaflet.js"></script>
    <link rel="stylesheet" href="dependencies/leaflet/leaflet.css" />
    <script src="dependencies/idb/umd.js"></script>
    <script src="dependencies/leaflet.offline/bundle.js"></script>
    <script src="dependencies/jszip/jszip.min.js"></script>
    <script src="dependencies/leaflet.contextmenu/leaflet.contextmenu.min.js"></script>
    <link rel="stylesheet" href="dependencies/leaflet.contextmenu/leaflet.contextmenu.min.css" />
    <link rel="stylesheet" href="dependencies/swiper/swiper-bundle.min.css" />
    <script src="dependencies/swiper/swiper-bundle.min.js"></script>
    <!--INFO: include our changes after libs to own them-->
    <link rel="stylesheet" href="index.css" />
</head>

<body>
    <div id="map"></div>
    <!-- Menu -->
    <button id="menu-button" class="overlay-button" onclick="setMenuVisible('menu', 'bottom', true)">
        <!--TODO: add menu icon -->
        <div style="border-style: solid">
            <h1>MENU</h1>
        </div>
    </button>
    <div id="menu" class="overlay" style="bottom: 100%">
        <button class="close-button" onclick="setMenuVisible('menu', 'bottom', false)">×</button>
        <div class="overlay-content">
            <div class="overlay-select">
                <label for="select_case">Choose Case:</label>
                <select id="select_case" onchange="handleCaseChange(this)">
                    <option value="Placeholder">
                </select>
            </div>
            <button onclick="askForFile(handleZipFile)">Upload Zip</button>
            <button onclick="askForFile(handleCaseFile)">Upload Case File</button>
            <button onclick="loadTestMap()">Load Test Map</button>
            <button onclick="resetCase()">Reset Case</button>
        </div>
    </div>
    <!-- Debug Menu -->
    <button id="debug-menu-button" class="overlay-button" onclick="setMenuVisible('debug-menu', 'bottom', true)">
        <!--TODO: add menu icon -->
        <div style="border-style: solid">
            <h1>DEBUG</h1>
        </div>
    </button>
    <div id="debug-menu" class="overlay" style="bottom: 100%">
        <button class="close-button" onclick="setMenuVisible('debug-menu', 'bottom', false)">×</button>
        <div class="overlay-content">
            <div class="overlay-input">
                <input type="checkbox" id="debug_toggle" onchange="Global.DEBUG = !Global.DEBUG" />
                <label for="debug_toggle">Debug</label>
            </div>
            <button onclick="clearMapDB()">Clear Map DB</button>
            <button onclick="clearCaseDB()">Clear Case DB</button>
            <button onclick="clearCaseImgDB()">Clear Case Img DB</button>
            <button onclick="solveStep()">Solve</button>
            <button onclick="progressCase()">Force Next</button>
        </div>
    </div>
    <!-- Objective -->
    <div id="objective-overlay" class="overlay-button">
        <p>Objective:</p>
        <p id="case_objective"></p>
    </div>
    <!-- Card Overlay -->
    <button id="card-overlay-button" class="overlay-button" onclick="setMenuVisible('card-menu', 'top', true)">
        <!--TODO: add menu icon -->
        <div style="border-style: solid">
            <h1>?</h1>
        </div>
    </button>
    <div id="card-menu" class="overlay" style="top: 100%">
        <div class="swiper-container">
            <div class="swiper-wrapper">
            </div>
            <div class="swiper-pagination"></div>
        </div>
        <button class="close-button" onclick="setMenuVisible('card-menu', 'top', false)">×</button>
    </div>
    <script>
        var Global = {
            DEBUG: window.location.protocol == "file:" || window.location.hostname == "localhost",
            map: null,
            baseLayer: null,
            cases: {},
            currentCase: null,
            caseProgress: 0, //TODO: read from/save to idb,
            caseMarkers: [],
            markers: [],
            mapMetadata: {
                name: "Placeholder",
                minZoom: 2,
                maxZoom: 6,
                width: 300,
                height: 300
            }
        }
    </script>
    <script src="ui.js"></script>
    <script src="upload.js"></script>
    <script src="contextmenu.js"></script>
    <script src="map.js"></script>
    <script src="case.js"></script>
    <script>
        document.getElementById("debug-menu-button").hidden = !Global.DEBUG; // hide if not debug
        document.getElementById("debug_toggle").checked = Global.DEBUG;

        initMap();
        refreshCases();
        initSwiper();
    </script>

</body>

</html>